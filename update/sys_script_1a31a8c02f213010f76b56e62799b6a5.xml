<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_script">
    <sys_script action="INSERT_OR_UPDATE">
        <abort_action>false</abort_action>
        <access>package_private</access>
        <action_delete>false</action_delete>
        <action_insert>true</action_insert>
        <action_query>false</action_query>
        <action_update>true</action_update>
        <active>true</active>
        <add_message>false</add_message>
        <advanced>true</advanced>
        <change_fields>false</change_fields>
        <client_callable>false</client_callable>
        <collection>incident</collection>
        <condition/>
        <description/>
        <execute_function>false</execute_function>
        <filter_condition table="incident">urgency=1^EQ<item display_value="1 - High" endquery="false" field="urgency" goto="false" newquery="false" operator="=" or="false" value="1"/>
            <item endquery="true" field="" goto="false" newquery="false" operator="=" or="false" value=""/>
        </filter_condition>
        <is_rest>false</is_rest>
        <message/>
        <name>Twilio Incident Notification</name>
        <order>100</order>
        <priority>100</priority>
        <rest_method/>
        <rest_method_text/>
        <rest_service/>
        <rest_service_text/>
        <rest_variables/>
        <role_conditions/>
        <script><![CDATA[(function executeRule(current, previous /*null when async*/) {
  //sys_id record for whatever object (eg. specific Incident record) is triggered by this Business Rule
  var id = current.getValue('sys_id');
  var assignedTo = current.getValue('assigned_to');

  gs.info('Twilio Incident Assigned: ' + assignedTo);
  gs.info('Twilio Incident sys_id: ' + id);
  //"u_channel_preference" is a custom field I created in ServiceNow to illustrate the ability to use this field and send to Twilio
  //var channel = current.caller_id.u_channel_preference;

  //This will be the Messaging Service SID on your Twilio Account (you need to set this up) and will be used to send SMS
  var from = 'MGa3ab55e4d7f77960fd1587809ffc189d';

  //Spin up a REST Message using ServiceNow's Native WebServices API and point to your Twilio Studio Flow REST API Execution URL
  var request = new sn_ws.RESTMessageV2();
  request.setEndpoint(
    'https://studio.twilio.com/v2/Flows/FW7abb5e72d6a6a8284093882c9d882b07/Executions'
  );
  request.setHttpMethod('POST');

  //Your Twilio Account SID and Auth Token to Authenticate this request
  var user = 'ACe5d4593b88bcb24f745bb2324f13a1ce';
  var password = 'ca422f525b7262f1c3a161fa78af02b0';

  request.setBasicAuth(user, password);

  //Request Headers for the most basic type of request for POC. Note that Twilio cannot accept a JSON blob, so Content-Type must be what is defined here
  request.setRequestHeader('Accept', '*/*');
  request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

  //You can modify the Body here to pass any parameters you need to pass from ServiceNow to Twilio
  request.setRequestBody(
    'To=' +
      current.assigned_to.mobile_phone +
      '&From=' +
      from +
      '&Parameters={"short_description":"' +
      current.short_description +
      '","phone":"' +
      current.assigned_to.mobile_phone +
      '", "number":"' +
      current.number +
      '", "sys_id":"' +
      id +
      '", "assigned_to":"' +
      assignedTo +
      '", "name":"' +
      current.assigned_to.first_name +
      ' ' +
      current.assigned_to.last_name +
      '", "urgency":"' +
      current.urgency +
      '"}'
  );

  var response = request.executeAsync();

  //Optionally update the Work Notes on the original object (eg. Incident). This is just an example of updating the ServiceNow object record. Use ServiceNow's REST API explorer to further investigate how you might update the record from Twilio during or after Studio Flow execution
  current.work_notes = response.getBody();
  current.update();
  //gs.log(response.getBody());
})(current, previous);]]></script>
        <sys_class_name>sys_script</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2021-07-19 15:41:10</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>1a31a8c02f213010f76b56e62799b6a5</sys_id>
        <sys_mod_count>3</sys_mod_count>
        <sys_name>Twilio Incident Notification</sys_name>
        <sys_overrides/>
        <sys_package display_value="ServiceNow Twilio Integration" source="x_8725_servicenow">10e83fe1db1233006a0f924bdb961947</sys_package>
        <sys_policy/>
        <sys_scope display_value="ServiceNow Twilio Integration">10e83fe1db1233006a0f924bdb961947</sys_scope>
        <sys_update_name>sys_script_1a31a8c02f213010f76b56e62799b6a5</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2021-07-19 16:18:46</sys_updated_on>
        <template/>
        <when>after</when>
    </sys_script>
    <sys_translated_text action="delete_multiple" query="documentkey=1a31a8c02f213010f76b56e62799b6a5"/>
</record_update>
